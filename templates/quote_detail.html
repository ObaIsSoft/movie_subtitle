{% extends 'base.html' %}

{% block content %}
<div class="row justify-content-center mt-3 mt-lg-5">
    <!-- POSTER SECTION -->
    <div class="col-md-4 col-lg-3 mb-4 mb-md-0 text-center text-md-end">
        {% if poster_url %}
        <img src="{{ poster_url }}" alt="{{ subtitle.movie.title }} Poster" class="img-fluid shadow-lg"
            style="border: 1px solid #333; max-height: 400px;">
        {% else %}
        <!-- Fallback if no poster -->
        <div
            style="height: 400px; background: #111; border: 1px solid #333; display: flex; align-items: center; justify-content: center; color: #333;">
            <i class="bi bi-film display-1"></i>
        </div>
        {% endif %}
    </div>

    <!-- CONTENT SECTION -->
    <div class="col-md-8 col-lg-6 text-center text-md-start">
        <!-- Movie Title -->
        {% if tmdb_id %}
        <a href="https://www.themoviedb.org/movie/{{ tmdb_id }}" target="_blank" class="text-decoration-none">
            <h1 class="display-4 mb-0"
                style="color: var(--text-white); transition: 0.3s; word-wrap: break-word; font-weight: bold;">
                {{ subtitle.movie.title }}
            </h1>
        </a>
        {% else %}
        <h1 class="display-4 mb-0" style="color: var(--text-white); font-weight: bold;">{{ subtitle.movie.title }}</h1>
        {% endif %}

        <div class="mt-2">
            <span class="px-3 py-1 text-uppercase d-inline-block"
                style="border: 1px solid #333; color: var(--accent-yellow); font-size: 0.8rem; letter-spacing: 2px;">
                Released {{ subtitle.movie.year }}
            </span>
        </div>

        <!-- The Quote -->
        <div class="my-4 py-4 border-top border-bottom border-secondary position-relative">
            <i class="bi bi-quote fs-1 text-secondary opacity-25 position-absolute top-0 start-0"></i>

            <!-- Previous Line -->
            {% if prev_subtitle %}
            <p class="fs-5 mb-2" style="color: rgba(255, 255, 255, 0.7);">
                ... {{ prev_subtitle.text }}
            </p>
            {% endif %}

            <!-- Main Quote -->
            <p class="display-6 fst-italic my-3"
                style="color: #fff; font-weight: 500; text-shadow: 0 0 15px rgba(255, 215, 0, 0.6);">
                "{{ subtitle.text }}"
            </p>

            <!-- Next Line -->
            {% if next_subtitle %}
            <p class="fs-5 mt-2" style="color: rgba(255, 255, 255, 0.7);">
                {{ next_subtitle.text }} ...
            </p>
            {% endif %}

            <!-- TIMESTAMP DISPLAY -->
            {% if subtitle.start_time %}
            <div class="mt-4 text-end">
                <span class="font-monospace text-uppercase small" style="color: #666;">
                    <i class="bi bi-clock me-1"></i> <span style="color: var(--accent-yellow);">{{
                        subtitle.start_time.split(',')[0] }}</span>
                </span>
            </div>
            {% endif %}
        </div>

        <!-- Streaming Info -->
        <div class="p-4" style="background-color: var(--bg-dark-grey); border: 1px solid #333;">
            <h6 class="text-uppercase mb-3" style="color: #666; letter-spacing: 2px; font-size: 0.8rem;">Streaming
                Availability</h6>

            {% if watch_link %}
            <a href="{{ watch_link }}" target="_blank" class="btn btn-primary w-100 py-3 mb-2">
                WATCH NOW (TMDB)
            </a>
            {% endif %}

            {% if justwatch_link %}
            <a href="{{ justwatch_link }}" target="_blank" class="btn btn-outline-warning w-100 py-3 mb-2">
                WATCH ON JUSTWATCH
            </a>
            {% endif %}

            {% if google_watchlist_link %}
            <a href="{{ google_watchlist_link }}" target="_blank" class="btn btn-outline-light w-100 py-3">
                <i class="bi bi-bookmark-plus me-2"></i> ADD TO WATCHLIST
            </a>
            {% endif %}

            {% if not watch_link and not justwatch_link and not google_watchlist_link %}
            <p class="mb-0 text-center" style="color: #666;">
                <i class="bi bi-x-circle me-2"></i> Not currently available.
            </p>
            {% else %}
            <p class="small mt-2 mb-0 text-end" style="color: #444;">
                Data provided by TMDb, JustWatch & Google
            </p>
            {% endif %}
        </div>

        <div class="mt-4">
            <a href="/" class="text-decoration-none text-uppercase small" style="color: #666; letter-spacing: 1px;">
                &larr; Back to Search
            </a>
        </div>
    </div>
</div>
{% endblock %}